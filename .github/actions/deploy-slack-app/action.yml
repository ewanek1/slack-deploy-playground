# Composite action that caches and installs CLI
name: Download Slack CLI
description: Install Slack CLI if needed and add to PATH
runs:
  using: composite
  steps:
    - name: Cache Slack CLI
      id: cache-cli
      uses: actions/cache@v4
      with:
        path: ~/.slack/bin
        key: slack-cli-${{ runner.os }}-${{ runner.arch }}-${{ env.SLACK_CLI_VERSION }}  
    - name: Add Slack CLI to PATH
      shell: bash
      if (runner.os == 'Linux' || runner.os == 'macOS'): 
        run: echo "$HOME/.slack/bin" >> $GITHUB_PATH 
      if (runner.os == 'Windows'):
        run: Out-File -FilePath $Env:GITHUB_ENV -Encoding utf8 -Append
      #line 1: Out-File: command not found 
    - name: Install Slack CLI (Linux/macOS)
      if:
        steps.cache-cli.outputs.cache-hit != 'true' && (runner.os == 'Linux' || runner.os == 'macOS')
      shell: bash
      run:
        curl -fsSL https://downloads.slack-edge.com/slack-cli/install.sh | bash -s -- -v $SLACK_CLI_VERSION
    - name: Install Slack CLI (Windows)
      if: steps.cache-cli.outputs.cache-hit != 'true' && runner.os == 'Windows'
      shell: powershell
      run: |
        irm https://downloads.slack-edge.com/slack-cli/install-windows.ps1 | iex
